<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½±ç‰‡è¡ŒéŠ·æ¨™æ¡ˆç›£æ¸¬å„€è¡¨æ¿</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: "Microsoft JhengHei", sans-serif; }
        .header-section { background: #0056b3; color: white; padding: 30px 0; margin-bottom: 20px; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .keyword-tag { font-size: 0.8rem; background: rgba(255,255,255,0.2); border-radius: 5px; padding: 2px 8px; margin-right: 5px; }
    </style>
</head>
<body>

<div class="header-section">
    <div class="container text-center">
        <h1>ğŸ¬ å½±ç‰‡è£½ä½œèˆ‡è¡ŒéŠ·æ¨™æ¡ˆç›£æ¸¬</h1>
        <p>è¿½è¹¤é—œéµå­—ï¼š
            <span class="keyword-tag">å½±ç‰‡</span><span class="keyword-tag">è£½ä½œ</span>
            <span class="keyword-tag">å®£å‚³</span><span class="keyword-tag">è¡ŒéŠ·</span><span class="keyword-tag">AI</span>
        </p>
        <div id="status">
            <div class="loader"></div> æ­£åœ¨å¾æ¡è³¼ç¶²æŠ“å–æœ€æ–°è³‡æ–™...
        </div>
    </div>
</div>

<div class="container">
    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>æ‹›æ¨™æ©Ÿé—œ</th>
                        <th>æ¨™æ¡ˆåç¨±</th>
                        <th>æ¡ˆè™Ÿ</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="tender-list">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 1. è¨­å®šä½ çš„é—œéµå­—
    const keywords = ["å½±ç‰‡", "è£½ä½œ", "å®£å‚³", "è¡ŒéŠ·", "AI", "çŸ­ç‰‡"];
    const tenderTable = document.getElementById('tender-list');
    const statusDiv = document.getElementById('status');

    // ç”¨ä¾†å„²å­˜ä¸é‡è¤‡æ¨™æ¡ˆçš„ç‰©ä»¶
    let allTenders = {};

    async function fetchTenders() {
        try {
            for (const kw of keywords) {
                // ç›´æ¥å‘¼å« g0v API (é€™åœ¨ç€è¦½å™¨ä¸Šæ˜¯å¯ä»¥è·‘çš„)
                const response = await fetch(`https://pcc.g0v.ronny.tw/api/searchbytitle?query=${encodeURIComponent(kw)}`);
                const data = await response.json();
                
                if (data.records) {
                    data.records.forEach(record => {
                        // ä½¿ç”¨æ¡ˆè™Ÿç•¶ Key é¿å…é‡è¤‡
                        allTenders[record.job_number] = record;
                    });
                }
            }
            renderTable();
        } catch (error) {
            statusDiv.innerHTML = "âŒ æŠ“å–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
            console.error(error);
        }
    }

    function renderTable() {
        // å°‡ç‰©ä»¶è½‰æˆé™£åˆ—ä¸¦æŒ‰æ—¥æœŸæ’åº
        const sortedList = Object.values(allTenders).sort((a, b) => b.date.localeCompare(a.date));
        
        if (sortedList.length === 0) {
            tenderTable.innerHTML = '<tr><td colspan="5" class="text-center">æŸ¥ç„¡ç›¸é—œæ¨™æ¡ˆ</td></tr>';
        } else {
            let html = "";
            sortedList.forEach(t => {
                const link = `https://pcc.g0v.ronny.tw/tender/${t.brief.type}/${t.job_number}`;
                html += `
                    <tr>
                        <td>${t.date || 'N/A'}</td>
                        <td>${t.unit_name}</td>
                        <td><strong class="text-primary">${t.brief.title}</strong></td>
                        <td><small class="text-muted">${t.job_number}</small></td>
                        <td><a href="${link}" target="_blank" class="btn btn-sm btn-outline-primary">è©³ç´°å…§å®¹</a></td>
                    </tr>
                `;
            });
            tenderTable.innerHTML = html;
        }
        statusDiv.innerHTML = `âœ… æƒæå®Œæˆï¼Œå…±ç™¼ç¾ ${sortedList.length} å€‹æ¨™æ¡ˆ`;
    }

    // ç•¶ç¶²é é–‹å•Ÿæ™‚è‡ªå‹•åŸ·è¡Œ
    fetchTenders();
</script>

</body>
</html>
